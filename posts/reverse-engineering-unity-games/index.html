<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="cat.jpg" />
<title>Reverse engineering Unity games | Jakub&#39;s tech blog</title>
<meta name="title" content="Reverse engineering Unity games" />
<meta name="description" content="few tips on modding games made with Unity Engine..." />
<meta name="keywords" content="" />






  
  <meta property="og:title" content="Reverse engineering Unity games" />
<meta property="og:description" content="few tips on modding games made with Unity Engine..." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jakubtomsu.github.io/posts/reverse-engineering-unity-games/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-03-24T00:00:00+00:00" /><meta property="og:site_name" content="Jakub&#39;s tech blog" />



  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reverse engineering Unity games"/>
<meta name="twitter:description" content="few tips on modding games made with Unity Engine..."/>


  
  <meta itemprop="name" content="Reverse engineering Unity games">
<meta itemprop="description" content="few tips on modding games made with Unity Engine..."><meta itemprop="datePublished" content="2022-03-24T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-03-24T00:00:00+00:00" />
<meta itemprop="wordCount" content="367">
<meta itemprop="keywords" content="" />

<meta name="referrer" content="no-referrer-when-downgrade" />

  
  <link href="/style.min.css" rel="stylesheet">

  
  <link href="/syntax.min.css" rel="stylesheet">

  

  
</head>

<body>
  <header><a href="/" class="title"><h2>Jakub&#39;s tech blog</h2></a>
<nav>
  <a href="/">About</a>

  <a href="/posts/">Posts</a>

  <a href="/projects/">Projects</a>


<a href="/posts/index.xml">RSS</a>







</nav>
</header>
  <main>

<h1>Reverse engineering Unity games</h1>
<p>
  <i>
    <time datetime='2022-03-24' pubdate>
      2022-03-24
    </time>
  </i>
</p>

<content>
  <p>Few months ago, I made a level editor mod for <a href="https://store.steampowered.com/app/1155650/Shady_Knight/">Shady Knight</a>,
an action game with lots of movement, parkour and combat. I thought I could share a few things related to reverse engineering the game and modding.</p>
<h2 id="accessing-source-code">accessing source code</h2>
<p>For a game, all of the gameplay source code is stored in <code>\SomeGame\SomeGame_Data\Managed\Assembly-CSharp.dll</code>. This is a <strong>dll</strong> (dynamically-linked library), which is generated from source files when the game is built.
To get the original source code, you need to decompile this dll. Fortunately, C# is quite easy to decompile, and there are many free and open-source tools on the internet.<br>
I personally really like <a href="https://github.com/dnSpy/dnSpy/releases/tag/v6.1.8">dnSpy</a>,
since it&rsquo;s also capable of compiling C# code (this means you can just change code from the original game)</p>
<h2 id="injecting-custom-code">injecting custom code</h2>
<p>It is of course possible to develop an entire mod by editing the <code>Assembly-CSharp.dll</code>, but it&rsquo;s easier to just create it separately and just load it at startup time.
This way your game can support multiple mods at the same time, because games can have one common loader for all mods.</p>
<p>If you want to inject the code yourself, here is a simple example how to load and run a C# dll:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span> <span class="c1">// loading dll&#39;s at runtime</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1">// just loop all types and find the entry point method</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// there are probably much better ways of doing this, but this worked for me</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span> <span class="k">in</span> <span class="n">Assembly</span><span class="p">.</span><span class="n">LoadFile</span><span class="p">(</span><span class="s">&#34;some dll path&#34;</span><span class="p">).</span><span class="n">GetTypes</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">	<span class="n">MethodInfo</span> <span class="n">method</span> <span class="p">=</span> <span class="n">type</span><span class="p">.</span><span class="n">GetMethod</span><span class="p">(</span><span class="s">&#34;some method with unique name&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">	<span class="k">if</span> <span class="p">(!(</span><span class="n">method</span> <span class="p">==</span> <span class="k">null</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">		<span class="kt">object</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">Activator</span><span class="p">.</span><span class="n">CreateInstance</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">		<span class="n">method</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This code sould ideally be placed in some method that runs <em>as early as possible</em>.
Probably <code>Awake</code> function on a component somewhere on the first loading screen, main menu, etc. is good enough.</p>
<h2 id="inspecting-the-renderer">inspecting the renderer</h2>
<p>With tools like <a href="https://developer.nvidia.com/nsight-graphics">NVIDIA Nsight</a>, <a href="https://renderdoc.org/">RenderDoc</a>, etc.
you can easily inspect what your GPU is doing, and how the game actually renders each frame.
You can also take a look at all kinds of resources in the game - shaders, textures, models, &hellip;</p>
<p>Here is a screenshot from Shady Knight when using RenderDoc:
<img src="/shady_knight_renderdoc.png" alt="shady knight screenshot">
as you can see, it shows everything you might need</p>

</content>
<p>
  
</p>

  </main>
  <footer><small>
  Jakub Tomšů (CC BY 4.0) | Made with <a href="https://github.com/clente/hugo-bearcub">Bear Cub</a>
</small></footer>

    
</body>

</html>
